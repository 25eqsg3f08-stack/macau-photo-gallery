<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>澳门街道离线图片浏览器</title>
    <meta name="description" content="跨仓库加载图片，支持自定义缓存数量、精准清除图片缓存">
    <link rel="stylesheet" href="/macau-photo-gallery/css/style.css">
    <!-- 注册 Service Worker 实现离线（修正路径+添加作用域） -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    // 关键：SW文件路径和作用域都要匹配子目录
                    const swReg = await navigator.serviceWorker.register('/macau-photo-gallery/sw.js', {
                        scope: '/macau-photo-gallery/' // 作用域必须覆盖项目路径
                    });
                    console.log('Service Worker 注册成功 → 离线模式已启用', swReg);
                } catch (error) {
                    console.error('Service Worker 注册失败:', error);
                }
            });
        }
    </script>
    <style>
        /* 新增：网络状态提示样式 */
        .network-status {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            z-index: 9999;
        }
        .online {
            background-color: #4CAF50;
            color: white;
        }
        .offline {
            background-color: #f44336;
            color: white;
        }
        /* 给容器加顶部边距，避免被状态条遮挡 */
        .container {
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <!-- 新增：实时网络状态提示条 -->
    <div id="network-status-bar" class="network-status online">当前网络：在线</div>

    <div class="container">
        <header class="header">
            <h1>澳门街道离线图片浏览器</h1>
            <p>图片源: <a href="https://github.com/25eqsg3f08-stack/Rua_de_macau_Photos" target="_blank">Rua_de_macau_Photos</a> | 缓存隔离: 仅清理图片</p>
        </header>

        <!-- 图片显示区 -->
        <div class="image-container">
            <img id="current-image" src="https://via.placeholder.com/1200x600?text=加载中..." alt="澳门街道图片" class="street-image">
            <div class="image-info">
                <span id="image-name">未加载图片</span>
                <span id="page-info">0/0</span>
            </div>
        </div>

        <!-- 翻页控制 -->
        <div class="control-buttons">
            <button id="prev-btn" class="btn" disabled>上一页</button>
            <button id="next-btn" class="btn" disabled>下一页</button>
        </div>

        <!-- 缓存控制区（核心：自定义数量 + 精准清除） -->
        <div class="cache-settings">
            <h3>离线缓存控制</h3>
            <div class="cache-option">
                <label for="cache-count">设置缓存图片数量:</label>
                <input type="number" id="cache-count" min="1" max="500" value="20" placeholder="输入1-500的数字">
            </div>
            <button id="cache-btn" class="btn btn-primary">开始缓存指定数量图片</button>
            <button id="clear-img-cache-btn" class="btn btn-danger">仅清除图片缓存（保留网页）</button>
            <p id="cache-status">缓存状态: 未初始化</p>
            <p id="cache-size">当前图片缓存大小: 0MB (0GB)</p>
        </div>
    </div>

    <script>
        // 新增：实时检测网络状态
        const statusBar = document.getElementById('network-status-bar');
        function updateNetworkStatus() {
            if (navigator.onLine) {
                statusBar.textContent = '当前网络：在线';
                statusBar.className = 'network-status online';
            } else {
                statusBar.textContent = '当前网络：离线（仅可查看已缓存图片）';
                statusBar.className = 'network-status offline';
            }
        }
        // 初始化状态
        updateNetworkStatus();
        // 监听网络变化
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
    </script>
    <script src="/macau-photo-gallery/js/storage.js"></script>
    <script src="/macau-photo-gallery/js/main.js"></script>
</body>
</html>