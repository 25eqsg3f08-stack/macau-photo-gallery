<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>澳门街道离线图片浏览器</title>
    <meta name="description" content="跨仓库加载图片，支持缓存包下载、自定义缓存数量与时效">
    <link rel="stylesheet" href="/macau-photo-gallery/css/style.css">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const swReg = await navigator.serviceWorker.register('/macau-photo-gallery/sw.js', {
                        scope: '/macau-photo-gallery/'
                    });
                    console.log('Service Worker 注册成功', swReg);
                } catch (error) {
                    console.error('Service Worker 注册失败:', error);
                }
            });
        }
    </script>
    <style>
        .network-status {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            z-index: 9999;
        }
        .online { background-color: #4CAF50; color: white; }
        .offline { background-color: #f44336; color: white; }
        .container { margin-top: 40px; }
        .cache-link {
            text-align: center;
            margin: 20px 0;
        }
        .cache-link a {
            padding: 10px 20px;
            background-color: #2196F3;
            color: white;
            text-decoration: none;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div id="network-status-bar" class="network-status online">当前网络：在线</div>
    <div class="container">
        <header class="header">
            <h1>澳门街道离线图片浏览器</h1>
            <p>图片源: <a href="https://github.com/25eqsg3f08-stack/Rua_de_macau_Photos" target="_blank">Rua_de_macau_Photos</a> | 支持缓存包下载</p>
        </header>

        <!-- 跳转缓存包下载页面入口 -->
        <div class="cache-link">
            <a href="/macau-photo-gallery/cache_dw.html">前往缓存包下载设置</a>
        </div>

        <div class="image-container">
            <img id="current-image" src="https://via.placeholder.com/1200x600?text=加载中..." alt="澳门街道图片" class="street-image">
            <div class="image-info">
                <span id="image-name">未加载图片</span>
                <span id="page-info">0/0</span>
            </div>
        </div>

        <div class="control-buttons">
            <button id="prev-btn" class="btn" disabled>上一页</button>
            <button id="next-btn" class="btn" disabled>下一页</button>
        </div>

        <div class="cache-settings">
            <h3>基础缓存控制</h3>
            <p id="cache-status">缓存状态: 未初始化</p>
            <p id="cache-size">当前图片缓存大小: 0MB (0GB)</p>
        </div>
    </div>

    <script>
        const statusBar = document.getElementById('network-status-bar');
        function updateNetworkStatus() {
            if (navigator.onLine) {
                statusBar.textContent = '当前网络：在线';
                statusBar.className = 'network-status online';
            } else {
                statusBar.textContent = '当前网络：离线（仅可查看已缓存图片）';
                statusBar.className = 'network-status offline';
            }
        }
        updateNetworkStatus();
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
    </script>
    <script src="/macau-photo-gallery/js/storage.js"></script>
    <script src="/macau-photo-gallery/js/main.js"></script>
</body>
</html>